// Eventdelegatie voor edit-iconen in popup
    document.addEventListener("click", async (e) => {
      if (e.target.classList.contains("edit-icon")) {
        const container = e.target.parentElement;
        const field = container.querySelector("span[contenteditable]");
        const label = container.querySelector("strong").textContent.replace(":", "").toLowerCase();
        const nieuweWaarde = prompt(`Nieuwe waarde voor ${label}`, field.textContent);
        if (!nieuweWaarde) return;
        field.textContent = nieuweWaarde;

        const updateKey = label.includes("naam") ? "name" : label.includes("organisatie") ? "organization" : "role";
        const naam = document.querySelector(".popup-content h2").textContent;
        const snapshot = await getDocs(collection(db, "users"));
        snapshot.forEach(async (docSnap) => {
          const data = docSnap.data();
          if (data.name === naam) {
            const docRef = docSnap.ref;
            await updateDoc(docRef, { [updateKey]: nieuweWaarde });
            alert(`${updateKey} bijgewerkt!`);
          }
        });
      }
    });

// Nieuwe gebruiker toevoegen (Auth + Firestore)
    async function addUser() {
      const name = prompt("Naam van gebruiker:");
      const organization = prompt("Organisatie:");
      const role = prompt("Rol (user/admin):", "user");
      const email = prompt("E-mail:");
      const password = prompt("Wachtwoord:");
      if (!name || !email || !password) return alert("Vul alle gegevens in.");

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        await setDoc(doc(db, "users", cred.user.uid), {
          name,
          organization,
          role,
          email
        });
        alert("Gebruiker succesvol aangemaakt!");
        loadUsers();
      } catch (err) {
        alert("Fout bij aanmaken: " + err.message);
      }
    }

// Nieuwe module toevoegen aan Firestore
    async function addModule() {
      const title = prompt("Titel van module:");
      const thumbnail = prompt("Link naar thumbnail:");
      const url = prompt("Link naar module:");
      const assignedTo = prompt("E-mail van gebruiker(s), komma-gescheiden:");
      if (!title || !url || !assignedTo) return alert("Vul alle verplichte velden in.");

      try {
        await addDoc(collection(db, "modules"), {
          title,
          thumbnail,
          url,
          assignedTo: assignedTo.split(",").map(e => e.trim())
        });
        alert("Module toegevoegd!");
      } catch (err) {
        alert("Fout bij toevoegen module: " + err.message);
      }
    }
